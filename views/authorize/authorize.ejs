<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <title>Dự án tốt nghiệp</title>
  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Favicons -->
  <link href="/assets/img/favicon.png" rel="icon" />
  <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect" />
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet" />

  <!-- Vendor CSS Files -->
  <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
  <link href="/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
  <link href="/assets/vendor/quill/quill.snow.css" rel="stylesheet" />
  <link href="/assets/vendor/quill/quill.bubble.css" rel="stylesheet" />
  <link href="/assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
  <link href="/assets/vendor/simple-datatables/style.css" rel="stylesheet" />

  <!-- Template Main CSS File -->
  <link href="/assets/css/style.css" rel="stylesheet" />

  <style>
    /* Tổng thể */
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #f8f9fa;
      color: #333;
      margin: 0;
      padding: 0;
    }

    .container-fluid {
      padding: 20px;
    }

    /* Thanh điều hướng */
    .nav-tabs {
      margin-bottom: 20px;
    }

    .nav-link {
      color: #495057;
      transition: color 0.3s ease;
    }

    .nav-link.active {
      color: #fff;
      background-color: #007bff;
    }

    .nav-link:hover {
      color: #007bff;
    }

    /* Jumbotron */
    section {
      padding: 60px 0;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #007bff;
    }

    p {
      color: #6c757d;
      font-size: 1rem;
    }

    /* Form đăng nhập và đăng ký */
    .card {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: none;
    }

    .card .btn {
      background-color: #007bff;
      color: #fff;
      transition: background-color 0.3s ease;
    }

    .card .btn:hover {
      background-color: #0056b3;
    }

    input.form-control {
      border-radius: 0;
      border: 1px solid #ced4da;
    }

    input.form-control:focus {
      box-shadow: none;
      border-color: #007bff;
    }

    /* Nút "Use Current Location" */
    button[type="button"] {
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 0.9rem;
      cursor: pointer;
      margin-top: 5px;
    }

    button[type="button"]:hover {
      background-color: #0056b3;
    }

    /* Cảnh báo lỗi */
    .alert-danger {
      font-size: 0.9rem;
      text-align: center;
    }

    /* Footer (nếu cần) */
    footer {
      text-align: center;
      padding: 20px 0;
      background-color: #343a40;
      color: #fff;
      margin-top: 40px;
    }

    footer a {
      color: #007bff;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <div class="container-fluid h-100">
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#login">Đăng nhập</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#register">Đăng ký</a>
      </li>
    </ul>

    <div class="tab-content">
      <div id="login" class="tab-pane fade show active">
        <section class="">
          <!-- Jumbotron -->
          <div class="px-4 py-5 px-md-5 text-center text-lg-start" style="background-color: hsl(0, 0%, 96%)">
            <div class="container">
              <div class="row gx-lg-5 align-items-center">
                <div class="col-lg-6 mb-5 mb-lg-0">
                  <h1 class="my-5 display-3 fw-bold ls-tight">
                    Hello ! <br />
                    <span class="text-primary">Cảm ơn bạn đã đến</span>
                  </h1>
                  <p style="color: hsl(217, 10%, 50.8%)">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                    Eveniet, itaque accusantium odio, soluta, corrupti aliquam
                    quibusdam tempora at cupiditate quis eum maiores libero
                    veritatis? Dicta facilis sint aliquid ipsum atque?
                  </p>
                </div>

                <div class="col-lg-6 mb-5 mb-lg-0">
                  <div class="card">
                    <div class="card-body py-5 px-md-5">
                      <form action="/users/login" method="post" id="loginForm" onsubmit="return validateLogin()">
                        <!-- 2 column grid layout with text inputs for the first and last names -->
                        <div class="row">
                          <div class="form-label">
                            <label class="form-label" for="loginUsername">Tên đăng nhập</label>
                            <input type="text" id="loginUsername" class="form-control" name="username" />
                          </div>
                        </div>

                        <!-- Password input -->
                        <div class="form-outline mb-4">
                          <label class="form-label" for="loginPassword">Mật khẩu</label>
                          <input type="password" id="loginPassword" class="form-control" name="password" />
                        </div>

                        <!-- Checkbox -->
                        <div class="form-check d-flex justify-content-center mb-4">
                          <input class="form-check-input me-2" type="checkbox" value="" id="form2Example33" />
                          <label class="form-check-label" for="form2Example33">
                            Lưu mật khẩu
                          </label>
                        </div>

                        <!-- Submit button -->
                        <button type="submit" class="btn btn-primary btn-block mb-4">
                          Đăng nhập
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Jumbotron -->
        </section>
      </div>
      <div id="register" class="tab-pane fade">
        <section class="">
          <div class="px-4 py-5 px-md-5 text-center text-lg-start" style="background-color: hsl(0, 0%, 96%)">
            <div class="container">
              <div class="row gx-lg-5 align-items-center">
                <div class="col-lg-6 mb-5 mb-lg-0">
                  <h1 class="my-5 display-3 fw-bold ls-tight">
                    Hãy đăng ký ngay ! <br />
                  </h1>
                  <p style="color: hsl(217, 10%, 50.8%)">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                    Eveniet, itaque accusantium odio, soluta, corrupti aliquam
                    quibusdam tempora at cupiditate quis eum maiores libero
                    veritatis? Dicta facilis sint aliquid ipsum atque?
                  </p>
                </div>

                <div class="col-lg-6 mb-5 mb-lg-0">
                  <div class="card">
                    <div class="card-body py-5 px-md-5">
                      <form action="/users/signup" method="post" id="signUpForm">
                        <!-- 2 column grid layout with text inputs for the first and last names -->
                        <div class="row">
                          <div class="col-md-6 mb-4">
                            <div class="form-label">
                              <label class="form-label" for="account">Tên đăng nhập</label>
                              <input type="text" id="account" class="form-control" name="account" />
                            </div>
                          </div>
                          <div class="col-md-6 mb-4">
                            <div class="form-label">
                              <label class="form-label" for="name">Tên nhà hàng</label>
                              <input type="text" id="name" class="form-control" name="name" />
                            </div>
                          </div>
                        </div>

                        <!-- Email input -->
                        <div class="row">
                          <div class="col-md-6 mb-4">
                            <label class="form-label" for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" class="form-control" name="email" />
                          </div>
                          <div class="col-md-6 mb-4">
                            <label class="form-label" for="phone">Số điện thoại</label>
                            <input type="number" id="phone" class="form-control" name="phone" />
                          </div>
                        </div>

                        <input type="hidden" id="latitude" name="latitude" />
                        <input type="hidden" id="longitude" name="longitude" />

                        <div class="row">
                          <div class="col-md-6 mb-4">
                            <label class="form-label" for="signupAdress">Địa chỉ</label>
                            <input style="width: 360px;" type="text" id="signupAdress" class="form-control"
                              name="address" placeholder="Nhập vị trí hoặc nhấn để tự động cập nhật" />
                          </div>
                          <div class="col-md-6 mb-4">
                            <button type="button"
                              style="margin-top: 30px; width: 150px; margin-left: 105px; height: 40px;"
                              onclick="getCurrentLocation()">Dùng vị trí hiện tại</button>
                          </div>
                        </div>

                        <!-- Password input -->
                        <div class="form-outline mb-4">
                          <label class="form-label" for="signupPassword">Mật khẩu</label>
                          <input type="password" id="signupPassword" class="form-control" name="password" />
                        </div>

                        <div class="form-outline mb-4">
                          <label class="form-label" for="signupRePassword">Nhập lại mật khẩu</label>
                          <input type="password" id="signupRePassword" class="form-control" name="rePassword" />
                        </div>

                        <!-- Checkbox -->
                        <div class="form-check d-flex justify-content-center mb-4">
                          <input class="form-check-input me-2" type="checkbox" value="checkbox" id="signupCheck" />
                          <label class="form-check-label" for="signupCheck">
                            Đồng ý điều khoản và bảo mật
                          </label>
                        </div>
                        <% try { %>
                          <% if (message) { %>
                            <div class="alert alert-danger" role="alert" id="msg">
                              <%= message %>
                            </div>
                            <% } %>
                              <% } catch (error) { %>
                                <p>Có lỗi xảy ra: <%= error.message %>
                                </p>
                                <% } %>
                                  <!-- Submit button -->
                                  <button type="submit" class="btn btn-primary btn-block mb-4">
                                    Đăng ký
                                  </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <!-- Vendor JS Files -->
  <!-- Đặt mã JavaScript ở cuối phần body hoặc sau phần HTML của bạn -->

  <script>
    function getCurrentLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            console.log("Latitude:", lat);
            console.log("Longitude:", lon);

            const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&addressdetails=1`;
            try {
              const response = await fetch(url);
              const data = await response.json();

              if (data && data.display_name) {
                document.getElementById("signupAdress").value = data.display_name;
                document.getElementById("latitude").value = lat;
                document.getElementById("longitude").value = lon;
              } else {
                alert("Không thể lấy địa chỉ từ vị trí hiện tại.");
              }
            } catch (error) {
              alert("Có lỗi xảy ra khi gọi API Nominatim.");
              console.error(error);
            }
          },
          () => {
            alert("Không thể truy cập vị trí. Hãy kiểm tra cài đặt trình duyệt.");
          }
        );
      } else {
        alert("Trình duyệt không hỗ trợ định vị.");
      }
    }

    document.getElementById("signupAdress").addEventListener("blur", async function () {
      const address = this.value.trim();

      if (!address) {
        alert("Vui lòng nhập địa chỉ.");
        return;
      }

      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&addressdetails=1`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (data && data.length > 0) {
          const lat = data[0].lat;
          const lon = data[0].lon;

          document.getElementById("latitude").value = lat;
          document.getElementById("longitude").value = lon;

          console.log("Tọa độ tìm thấy:", { lat, lon });
        } else {
          alert(`Không thể tìm thấy tọa độ cho địa chỉ: ${address}`);
        }
      } catch (error) {
        alert("Có lỗi xảy ra khi tìm tọa độ.");
        console.error(error);
      }
    });

  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("signUpForm");

      // Bắt sự kiện submit của form
      form.addEventListener("submit", async function (event) {
        // Kiểm tra ID của form
        event.preventDefault();
        if (form.id === "signUpForm") {
          // Kiểm tra mật khẩu và mật khẩu nhập lại
          const passwordInput = document.getElementById("signupPassword");
          const rePasswordInput = document.getElementById("signupRePassword");
          if (passwordInput.value !== rePasswordInput.value) {
            event.preventDefault();
            alert("Mật khẩu nhập lại không khớp. Vui lòng kiểm tra lại.");
            return;
          }

          // Lấy danh sách tất cả các trường input trong form
          const formInputs = form.querySelectorAll("input");
          // Kiểm tra xem tất cả các trường input có giá trị không
          for (const input of formInputs) {
            if (!input.value) {
              // Nếu có một trường không có giá trị, ngăn chặn sự kiện submit
              event.preventDefault();

              // Hiển thị thông báo
              alert("Vui lòng nhập đầy đủ thông tin trong form.");
              return; // Dừng kiểm tra khi gặp trường không có giá trị
            }
          }
          const checkboxInput = document.getElementById("signupCheck");
          if (!checkboxInput.checked) {
            event.preventDefault();
            alert("Vui lòng đồng ý với điều khoản và bảo mật.");
          }

          const account = document.getElementById("account").value;
          const email = document.getElementById("signupEmail").value;

          try {
            const response = await fetch("/res/check-register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ account, email }),
            });
            console.log(response);
            if (response.ok) {
              const result = await response.json();
              console.log(result);
              if (result.accountExists || result.emailExists) {
                alert(
                  "Tài khoản hoặc email đã tồn tại. Vui lòng chọn thông tin khác."
                );
              } else {
                // Nếu tài khoản và email không tồn tại, có thể submit form
                form.submit();
              }
            } else {
              event.preventDefault();

              alert("Có lỗi khi kiểm tra tài khoản và email.");
            }
          } catch (error) {
            event.preventDefault();
            console.error("Lỗi khi kiểm tra tài khoản và email:", error);
            alert("Có lỗi khi kiểm tra tài khoản và email.");
          }
        }
      });
    });
  </script>
  <script src="/assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/vendor/chart.js/chart.umd.js"></script>
  <script src="/assets/vendor/echarts/echarts.min.js"></script>
  <script src="/assets/vendor/quill/quill.min.js"></script>
  <script src="/assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="/assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="/assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="/assets/js/main.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.3/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</body>

</html>